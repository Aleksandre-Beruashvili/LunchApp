@page "/login"
@using LunchApp.Shared.DTOs
@inject LunchApp.Client.Services.AuthService AuthService
@inject NavigationManager Nav

<EditForm Model="model" OnValidSubmit="HandleLogin"
          class="card mx-auto p-4 shadow-sm" style="max-width:400px;">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <h3 class="text-center mb-3">Login</h3>

    <div class="mb-3">
        <InputText @bind-Value="model.Email"
                   class="form-control"
                   placeholder="Email" />
        <ValidationMessage For="@(() => model.Email)" />
    </div>
    <div class="mb-3">
        <InputText @bind-Value="model.Password"
                   type="password"
                   class="form-control"
                   placeholder="Password" />
        <ValidationMessage For="@(() => model.Password)" />
    </div>

    <button class="btn btn-primary w-100" type="submit">
        Login
    </button>

    @if (!string.IsNullOrEmpty(error))
    {
        <div class="alert alert-danger mt-3">@error</div>
    }
</EditForm>

@code {
    private LoginDto model = new();
    private string error;

    private async Task HandleLogin()
    {
        error = null;
        var (ok, msg) = await AuthService.Login(model);
        if (ok)
            Nav.NavigateTo("/home");
        else
            error = msg;
    }
}
