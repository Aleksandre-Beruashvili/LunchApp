@page "/order"
@inject ApiService Api

<h3>Place Order</h3>

@if (timeSlots == null)
{
    <p>Loading slots...</p>
}
else
{
    <p>Select a pickup time:</p>
    <ul>
        @foreach (var slot in timeSlots)
        {
            <li><button @onclick="() => SelectTime(slot.Time)">🕒 @slot.Time (@slot.Count orders)</button></li>
        }
    </ul>
    @if (!string.IsNullOrEmpty(selectedTime))
    {
        <p>Selected: @selectedTime</p>
        <button @onclick="SubmitOrder">Submit Order</button>
    }
}

@code {
    List<TimeSlot> timeSlots;
    string selectedTime;

    protected override async Task OnInitializedAsync()
    {
        timeSlots = await Api.GetTimeSlots(DateTime.Today);
    }
    void SelectTime(string time) => selectedTime = time;
    async Task SubmitOrder()
    {
        var dto = new OrderCreateDto
        {
            SlotId = 1,
            Items = new List<OrderItemDto>
            {
                new() { DishId = 1, Quantity = 1 }
            }
        };
        await Api.PlaceOrder(dto);
    }
}
